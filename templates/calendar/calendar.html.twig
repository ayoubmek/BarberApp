<!DOCTYPE html>
<html lang="en">
<head>
    <base href="../"/>
    <title>Metronic Calendar</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <link rel="shortcut icon" href="assets/media/logos/favicon.ico" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
    <link href="assets/plugins/custom/fullcalendar/fullcalendar.bundle.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
</head>

<body id="kt_body" class="header-fixed header-tablet-and-mobile-fixed toolbar-enabled">
<script>
    var defaultThemeMode = "light";
    var themeMode;
    if (document.documentElement) {
        if (document.documentElement.hasAttribute("data-bs-theme-mode")) {
            themeMode = document.documentElement.getAttribute("data-bs-theme-mode");
        } else if (localStorage.getItem("data-bs-theme") !== null) {
            themeMode = localStorage.getItem("data-bs-theme");
        } else {
            themeMode = defaultThemeMode;
        }
        if (themeMode === "system") {
            themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        }
        document.documentElement.setAttribute("data-bs-theme", themeMode);
    }
</script>
<br><br><br><br><br><br>
<div class="d-flex flex-column flex-root">
    <div class="page d-flex flex-row flex-column-fluid">
        <div class="wrapper d-flex flex-column flex-row-fluid" id="kt_wrapper">
            <div id="kt_content_container" class="d-flex flex-column-fluid align-items-start container-xxl">
                <div class="content flex-row-fluid" id="kt_content">
                    <!-- Calendar Card -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title fw-bold">Calendar</h2>
                            <div class="card-toolbar">
                                <button class="btn btn-flex btn-primary" data-kt-calendar="add">
                                    <i class="ki-duotone ki-plus fs-2"></i>Add Reservation
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="kt_calendar_app"></div>
                        </div>
                    </div>

                    <!-- Add Event Modal -->
                    <div class="modal fade" id="kt_modal_add_event" tabindex="-1" aria-hidden="true" data-bs-focus="false">
                        <div class="modal-dialog modal-dialog-centered mw-650px">
                            <div class="modal-content">
                                <form class="form" action="#" id="kt_modal_add_event_form">
                                    <div class="modal-header">
                                        <h2 class="fw-bold" data-kt-calendar="title">Add Reservation</h2>
                                        <div class="btn btn-icon btn-sm btn-active-icon-primary" id="kt_modal_add_event_close">
                                            <i class="ki-duotone ki-cross fs-1"><span class="path1"></span><span class="path2"></span></i>
                                        </div>
                                    </div>
                                    <div class="modal-body py-10 px-lg-17">
                                        <div class="fv-row mb-9">
                                            <label class="fs-6 fw-semibold required mb-2">Reservation Name</label>
                                            <input type="text" class="form-control form-control-solid" name="calendar_event_name" />
                                        </div>
                                        <div class="fv-row mb-9">
                                            <label class="fs-6 fw-semibold mb-2">Reservation Description</label>
                                            <input type="text" class="form-control form-control-solid" name="calendar_event_description" />
                                        </div>
                                        <div class="fv-row mb-9">
                                            <label class="fs-6 fw-semibold mb-2">Reservation Location</label>
                                            <input type="text" class="form-control form-control-solid" name="calendar_event_location" />
                                        </div>
                                        <div class="fv-row mb-9">
                                            <label class="form-check form-check-custom form-check-solid">
                                                <input class="form-check-input" type="checkbox" id="kt_calendar_datepicker_allday" />
                                                <span class="form-check-label fw-semibold" for="kt_calendar_datepicker_allday">All Day</span>
                                            </label>
                                        </div>
                                        <div class="row row-cols-lg-2 g-10">
                                           <div class="col">
											<div class="fv-row mb-9">
												<label class="fs-6 fw-semibold mb-2 required">Reservation Start Date</label>
											<input 
											type="datetime-local"
											class="form-control form-control-solid"
											name="calendar_event_start_date"
											id="kt_calendar_datepicker_start_date"
										/>
											</div>
										</div>

                                            <div class="col" data-kt-calendar="datepicker">
                                                <div class="fv-row mb-9">
                                                    <label class="fs-6 fw-semibold mb-2">Reservation Start Time</label>
                                                    <input class="form-control form-control-solid" name="calendar_event_start_time" id="kt_calendar_datepicker_start_time" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row row-cols-lg-2 g-10">
                                            <div class="col">
                                                <div class="fv-row mb-9">
                                                    <label class="fs-6 fw-semibold mb-2 required">Reservation End Date</label>
													<input 
											type="datetime-local"
											class="form-control form-control-solid"
											name="calendar_event_end_date"
											id="kt_calendar_datepicker_end_date"
										/>
										</div>
                                            </div>
                                            <div class="col" data-kt-calendar="datepicker">
                                                <div class="fv-row mb-9">
                                                    <label class="fs-6 fw-semibold mb-2">Reservation End Time</label>
                                                    <input class="form-control form-control-solid" name="calendar_event_end_time" id="kt_calendar_datepicker_end_time" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer flex-center">
                                        <button type="reset" id="kt_modal_add_event_cancel" class="btn btn-light me-3">Cancel</button>
                                        <button type="button" id="kt_modal_add_event_submit" class="btn btn-primary">
                                            <span class="indicator-label">Submit</span>
                                            <span class="indicator-progress">Please wait...
                                                <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                            </span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- View Event Modal -->
                    <div class="modal fade" id="kt_modal_view_event" tabindex="-1" aria-hidden="true" data-bs-focus="false">
                        <div class="modal-dialog modal-dialog-centered mw-650px">
                            <div class="modal-content">
                                <div class="modal-header border-0 justify-content-end">
                                    <div class="btn btn-icon btn-sm btn-color-gray-400 btn-active-icon-primary me-2" id="kt_modal_view_event_edit">
                                        <i class="ki-duotone ki-pencil fs-2"><span class="path1"></span><span class="path2"></span></i>
                                    </div>
                                    <div class="btn btn-icon btn-sm btn-color-gray-400 btn-active-icon-danger me-2" id="kt_modal_view_event_delete">
                                        <i class="ki-duotone ki-trash fs-2"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span></i>
                                    </div>
                                    <div class="btn btn-icon btn-sm btn-color-gray-500 btn-active-icon-primary" data-bs-dismiss="modal">
                                        <i class="ki-duotone ki-cross fs-2x"><span class="path1"></span><span class="path2"></span></i>
                                    </div>
                                </div>
                                <div class="modal-body pt-0 pb-20 px-lg-17">
                                    <div class="d-flex">
                                        <i class="ki-duotone ki-calendar-8 fs-1 text-muted me-5"></i>
                                        <div class="mb-9">
                                            <div class="d-flex align-items-center mb-2">
                                                <span class="fs-3 fw-bold me-3" data-kt-calendar="event_name"></span>
                                                <span class="badge badge-light-success" data-kt-calendar="all_day"></span>
                                            </div>
                                            <div class="fs-6" data-kt-calendar="event_description"></div>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="bullet bullet-dot h-10px w-10px bg-success ms-2 me-7"></span>
                                        <div class="fs-6">
                                            <span class="fw-bold">Starts</span>
                                            <span data-kt-calendar="event_start_date"></span>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center mb-9">
                                        <span class="bullet bullet-dot h-10px w-10px bg-danger ms-2 me-7"></span>
                                        <div class="fs-6">
                                            <span class="fw-bold">Ends</span>
                                            <span data-kt-calendar="event_end_date"></span>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <i class="ki-duotone ki-geolocation fs-1 text-muted me-5"></i>
                                        <div class="fs-6" data-kt-calendar="event_location"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Modals -->

                </div>
            </div>
        </div>
    </div>
</div>

<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
    <i class="ki-duotone ki-arrow-up"><span class="path1"></span><span class="path2"></span></i>
</div>

<!-- Scripts -->
<script src="assets/plugins/global/plugins.bundle.js"></script>
<script src="assets/js/scripts.bundle.js"></script>
<script src="assets/plugins/custom/fullcalendar/fullcalendar.bundle.js"></script>
<script src="assets/plugins/custom/datatables/datatables.bundle.js"></script> 
<script src="assets/js/widgets.bundle.js"></script>
<script src="assets/js/custom/widgets.js"></script>
<script src="assets/js/custom/utilities/modals/create-app.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let calendarEvents = {{ events|json_encode|raw }};

    let eventsForFullCalendar = calendarEvents.map(e => ({
        id: e.id,
        title: e.title,
        start: e.start,
        end: e.end,
        allDay: e.allDay,
        description: e.description,
        location: e.location
    }));

    let calendarEl = document.getElementById('kt_calendar_app');
    let calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 650,
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: eventsForFullCalendar,
        eventClick: function(info) {
            document.querySelector('[data-kt-calendar="event_name"]').textContent = info.event.title;
            document.querySelector('[data-kt-calendar="event_description"]').textContent = info.event.extendedProps.description || '';
            document.querySelector('[data-kt-calendar="event_location"]').textContent = info.event.extendedProps.location || '';
            document.querySelector('[data-kt-calendar="event_start_date"]').textContent = info.event.start.toLocaleString();
            document.querySelector('[data-kt-calendar="event_end_date"]').textContent = info.event.end ? info.event.end.toLocaleString() : '';
            document.querySelector('[data-kt-calendar="all_day"]').textContent = info.event.allDay ? 'All Day' : '';
            
            var viewModal = new bootstrap.Modal(document.getElementById('kt_modal_view_event'));
            viewModal.show();
        }
    });

    calendar.render();

    // Open Add Event Modal
    document.querySelector('[data-kt-calendar="add"]').addEventListener('click', function() {
        var addModal = new bootstrap.Modal(document.getElementById('kt_modal_add_event'));
        addModal.show();
    });

    // Submit Add Event
    document.getElementById('kt_modal_add_event_submit').addEventListener('click', function() {
        const form = document.getElementById('kt_modal_add_event_form');
        const formData = new FormData();

        // Correct keys to match your controller
        formData.append('title', form.querySelector('[name="calendar_event_name"]').value);
        formData.append('description', form.querySelector('[name="calendar_event_description"]').value);
        formData.append('location', form.querySelector('[name="calendar_event_location"]').value);
        formData.append('start', form.querySelector('[name="calendar_event_start_date"]').value + ' ' + form.querySelector('[name="calendar_event_start_time"]').value);
        formData.append('end', form.querySelector('[name="calendar_event_end_date"]').value + ' ' + form.querySelector('[name="calendar_event_end_time"]').value);
        formData.append('allDay', form.querySelector('#kt_calendar_datepicker_allday').checked ? 1 : 0);

        fetch('{{ path("calendar_add") }}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                // Add new event to calendar
                calendar.addEvent({
                    id: data.id,
                    title: formData.get('title'),
                    start: formData.get('start'),
                    end: formData.get('end'),
                    allDay: formData.get('allDay') == 1,
                    description: formData.get('description'),
                    location: formData.get('location')
                });

                // Hide modal and reset form
                form.reset();
                var addModal = bootstrap.Modal.getInstance(document.getElementById('kt_modal_add_event'));
                addModal.hide();
            } else {
                alert(data.message || "Error saving event");
            }
        })
        .catch(err => console.error(err));
    });
});
</script>


</body>
</html>
